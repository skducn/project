-- 表格1
SELECT 
COUNT(*) AS 用户总数,
SUM(IFNULL((SELECT ROUND(SUM(b.amount)/100,2)  FROM t_user_red_footprint b 
  WHERE a.id=b.belongId  AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(b.create_time)),'0')) AS 已领取红包总额,
SUM(IFNULL((SELECT ROUND(SUM(c.amount)/100,2)  FROM t_user_withdraw c 
WHERE a.id=c.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(c.create_time) AND c.moneyType=39 ),'0')) AS 账户余额微信充值,
SUM( IFNULL((SELECT ROUND(SUM(d.amount)/100,2)  FROM t_user_withdraw d 
  WHERE a.id=d.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(d.create_time) AND d.moneyType=37  ),'0')) AS 从其他账户转入金额,
SUM(IFNULL((SELECT ROUND(SUM(e.amount)/100,2)   FROM game.t_game_account_detail e 
  WHERE a.id=e.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(e.create_time) AND e.pay_type=3 ),'0')) AS 从本账户转入其他账户余额,
SUM(IFNULL((SELECT ROUND(SUM(f.channelRedSumAmount)/100,2) FROM t_extension_channel f 
  WHERE a.id=f.userId   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(f.createTime) AND f.redType =21 AND source=3),'0')) AS 余额发红包,
SUM(IFNULL((SELECT ROUND(SUM(g.create_time)/100,2) FROM t_user_withdraw g 
  WHERE a.id=g.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(g.create_time) AND g.moneyType =40 ),'0')) AS 余额发图文,
SUM(IFNULL((SELECT ROUND(SUM(h.amount)/100,2)  FROM t_user_withdraw h 
WHERE a.id=h.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(h.create_time) AND h.w_state IN(0,1) AND h.moneyType=9 ),'0')) AS 已提现金额,
SUM(ROUND(a.commission_residue/100,2)) AS 账户余额,
date(now()) AS 截止日期
FROM t_user a
WHERE (SELECT ROUND(SUM(b.amount)/100,2)  FROM t_user_red_footprint b 
  WHERE a.id=b.belongId  AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(b.create_time))>0 
  OR ((SELECT ROUND(SUM(c.amount)/100,2)  FROM t_user_withdraw c 
  WHERE a.id=c.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(c.create_time) AND c.moneyType=39 ))>0
OR ((SELECT ROUND(SUM(d.amount)/100,2)  FROM t_user_withdraw d 
  WHERE a.id=d.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(d.create_time) AND d.moneyType=37  ))>0
OR ((SELECT ROUND(SUM(e.amount)/100,2)   FROM game.t_game_account_detail e 
  WHERE a.id=e.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(e.create_time) AND e.pay_type=3 ))>0 
OR ((SELECT ROUND(SUM(f.channelRedSumAmount)/100,2) FROM t_extension_channel f 
  WHERE a.id=f.userId   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(f.createTime) AND f.redType =21 AND source=3))>0
OR ((SELECT ROUND(SUM(g.create_time)/100,2) FROM t_user_withdraw g 
  WHERE a.id=g.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(g.create_time) AND g.moneyType =40 ))>0
OR ((SELECT ROUND(SUM(h.amount)/100,2)  FROM t_user_withdraw h 
WHERE a.id=h.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(h.create_time) AND h.w_state IN(0,1) AND h.moneyType=9 ))>0;

-- 表格2
SELECT
  a.id,
  a.nickName 用户昵称,
  a.userName 手机号,
 IFNULL((SELECT ROUND(SUM(b.amount)/100,2)  FROM t_user_red_footprint b 
  WHERE a.id=b.belongId  AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(b.create_time)),'0') AS 已领取红包总额,
IFNULL((SELECT ROUND(SUM(c.amount)/100,2)  FROM t_user_withdraw c 
WHERE a.id=c.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(c.create_time) AND c.moneyType=39 ),'0') AS 账户余额微信充值,
 IFNULL((SELECT ROUND(SUM(d.amount)/100,2)  FROM t_user_withdraw d 
  WHERE a.id=d.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(d.create_time) AND d.moneyType=37  ),'0')  AS 从其他账户转入金额,
  IFNULL((SELECT ROUND(SUM(e.amount)/100,2)   FROM game.t_game_account_detail e 
  WHERE a.id=e.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(e.create_time) AND e.pay_type=3 ),'0')  AS 从本账户转入其他账户余额,
  IFNULL((SELECT ROUND(SUM(f.channelRedSumAmount)/100,2) FROM t_extension_channel f 
  WHERE a.id=f.userId   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(f.createTime) AND f.redType =21  AND source=3 ),'0')  AS 余额发红包,
IFNULL((SELECT ROUND(SUM(g.create_time)/100,2) FROM t_user_withdraw g 
  WHERE a.id=g.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(g.create_time) AND g.moneyType =40 ),'0')  AS 余额发图文,
  IFNULL((SELECT ROUND(SUM(h.amount)/100,2)  FROM t_user_withdraw h 
WHERE a.id=h.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(h.create_time) AND h.w_state IN(0,1) AND h.moneyType=9 ),'0')  AS 已提现金额,
ROUND(a.commission_residue/100,2) 账户余额
FROM t_user a
HAVING CONCAT(已领取红包总额,账户余额微信充值,从其他账户转入金额,从本账户转入其他账户余额,余额发红包,已提现金额,余额发图文)<> '0000000';

-- 明细
SELECT b.belongId,IFNULL(ROUND(b.amount/100,2),'0') AS 领取红包金额,
b.create_time AS 领取时间,
a.nickname 红包推广人
FROM t_user a 
LEFT JOIN t_user_red_footprint b 
  ON a.id=b.userId AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(b.create_time)
HAVING CONCAT (领取红包金额) <> '0' ORDER BY b.belongId ASC;

SELECT h.user_id,IFNULL(ROUND(h.amount/100,2),'0') AS 提现红包金额,
h.create_time AS 申请提现时间,
h.w_state AS 提现状态,
h.time_end AS 提现成功时间
FROM t_user a  LEFT JOIN t_user_withdraw h 
ON a.id=h.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(h.create_time) AND h.w_state IN(0,1) AND h.moneyType=9 
HAVING CONCAT (提现红包金额) <> '0' ORDER BY h.user_id ASC;

SELECT c.user_id,IFNULL(ROUND(c.amount/100,2),'0') AS 充值金额,
c.create_time AS 充值时间
FROM t_user a LEFT JOIN t_user_withdraw c 
ON a.id=c.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(c.create_time) AND c.moneyType=39
HAVING CONCAT (充值金额) <> '0' ORDER BY c.user_id ASC;

SELECT d.user_id,d.create_time,
IFNULL(ROUND(d.amount/100,2),'0') AS 从游戏账户转入金额  FROM t_user a 
LEFT JOIN t_user_withdraw d 
  ON a.id=d.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(d.create_time) AND d.moneyType=37
HAVING CONCAT (从游戏账户转入金额) <> '0' ORDER BY d.user_id ASC;

SELECT e.user_id,e.create_time,
IFNULL(ROUND(e.amount/100,2),'0') AS 转出到游戏账户金额  FROM t_user a 
LEFT JOIN game.t_game_account_detail e 
  ON a.id=e.user_id   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(e.create_time) AND e.pay_type=3
HAVING CONCAT (转出到游戏账户金额) <> '0' ORDER BY e.user_id;

SELECT f.userId,f.createTime,
IFNULL(ROUND(f.channelRedSumAmount/100,2),'0')  AS 发红包使用金额 FROM t_user a  LEFT JOIN t_extension_channel f 
  ON a.id=f.userId   AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(f.createTime)AND f.redType =21 AND source=3 AND f.channelRedNumber>0
HAVING CONCAT (发红包使用金额) <> '0' ORDER BY f.userId ASC;

SELECT g.user_id,create_time,
IFNULL(ROUND(SUM(g.create_time)/100,2),'0')  AS 发放图文使用金额 FROM t_user_withdraw g 
  WHERE  DATE_SUB(CURDATE(), INTERVAL 1 WEEK) < date(g.create_time) AND g.moneyType =40  
HAVING CONCAT (发放图文使用金额) <> '0' ORDER BY g.user_id ASC;